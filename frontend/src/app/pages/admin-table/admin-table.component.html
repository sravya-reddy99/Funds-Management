<div class="bg">
  <div class="page">
    <header class="hero">
      <div class="hero-left">
        <div class="badge">Admin Console</div>
        <h1>Funds Management</h1>
        <p class="sub">
          Filter, sort, paginate, view details, and edit funds.
        </p>
      </div>

      <div class="hero-actions">
        <button class="btn ghost" (click)="clearFilters()">Clear filters</button>
        <button class="btn primary" (click)="refresh()">Refresh</button>
      </div>
    </header>

    <section class="card filters">
      <div class="filters-head">
        <h2>Filters</h2>
        <div class="meta">
          <span class="dot"></span>
          <span>Tip: filters update instantly</span>
        </div>
      </div>

      <div class="grid">
        <div class="field">
          <label>Name contains</label>
          <input [(ngModel)]="fName" (ngModelChange)="onFilterChanged()" placeholder="e.g., Fund 3" />
        </div>

        <div class="field">
          <label>Currency</label>
          <select [(ngModel)]="fCurrency" (ngModelChange)="onFilterChanged()">
            <option value="">All</option>
            <option *ngFor="let c of currencies()" [value]="c">{{ c }}</option>
          </select>
        </div>

        <div class="field">
          <label>Strategy</label>
          <select [(ngModel)]="fStrategy" (ngModelChange)="onFilterChanged()">
            <option value="">All</option>
            <option *ngFor="let s of strategies()" [value]="s">{{ s }}</option>
          </select>
        </div>

        <div class="field">
          <label>Geography</label>
          <select [(ngModel)]="fGeography" (ngModelChange)="onFilterChanged()">
            <option value="">All</option>
            <option *ngFor="let g of geographies()" [value]="g">{{ g }}</option>
          </select>
        </div>

        <div class="field">
          <label>Manager</label>
          <select [(ngModel)]="fManager" (ngModelChange)="onFilterChanged()">
            <option value="">All</option>
            <option *ngFor="let m of managers()" [value]="m">{{ m }}</option>
          </select>
        </div>

        <div class="field">
          <label>Description contains</label>
          <input [(ngModel)]="fDescription" (ngModelChange)="onFilterChanged()" placeholder="e.g., long/short equity" />
        </div>

        <div class="field">
          <label>Fund Size min</label>
          <input type="number" [(ngModel)]="fundSizeMin" (ngModelChange)="onFilterChanged()" placeholder="0" />
        </div>

        <div class="field">
          <label>Fund Size max</label>
          <input type="number" [(ngModel)]="fundSizeMax" (ngModelChange)="onFilterChanged()" placeholder="5000" />
        </div>

        <div class="field">
          <label>Vintage min</label>
          <input type="number" [(ngModel)]="vintageMin" (ngModelChange)="onFilterChanged()" placeholder="1990" />
        </div>

        <div class="field">
          <label>Vintage max</label>
          <input type="number" [(ngModel)]="vintageMax" (ngModelChange)="onFilterChanged()" placeholder="2025" />
        </div>
      </div>
    </section>

    <section class="card table-card">
      <div class="table-top">
        <div class="count">
            Showing
            <b>{{ pageItems().length }}</b>
            of
            <b>{{ totalItems() }}</b>
            matching results
        </div>
        <div class="right-tools">
          <div class="sort">
            <span class="muted">Sort:</span>
            <button class="chip" (click)="setSort('name')">Name</button>
            <button class="chip" (click)="setSort('currency')">Currency</button>
            <button class="chip" (click)="setSort('fundSize')">Fund Size</button>
            <button class="chip" (click)="setSort('vintage')">Vintage</button>
            <span class="sort-state">{{ sortBy() }} • {{ sortDir() }}</span>
          </div>

          <div class="page-size">
            <span class="muted">Rows:</span>
            <select [ngModel]="pageSize()" (ngModelChange)="setPageSize($event)">
              <option *ngFor="let s of pageSizeOptions" [ngValue]="s">{{ s }}</option>
            </select>
          </div>
        </div>
      </div>

      <div *ngIf="loading()" class="state">Loading…</div>
      <div *ngIf="error()" class="state error">{{ error() }}</div>

      <div class="table-wrap" *ngIf="!loading() && !error()">
        <table>
          <thead>
            <tr>
              <th class="click" (click)="setSort('name')">Name</th>
              <th>Strategies</th>
              <th>Geographies</th>
              <th class="click" (click)="setSort('currency')">Currency</th>
              <th class="num click" (click)="setSort('fundSize')">Fund Size</th>
              <th class="num click" (click)="setSort('vintage')">Vintage</th>
              <th>Managers</th>
              <th class="actions">Edit</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let f of pageItems()">
              <td class="name">
                <a [routerLink]="['/fund', f.id]" class="name-link">{{ f.name }}</a>
                <div class="desc">{{ f.description }}</div>
              </td>

              <td>
                <div class="tags">
                  <span class="tag tag-strategy" *ngFor="let s of f.strategies">{{ s }}</span>
                </div>
              </td>

              <td>
                <div class="tags">
                  <span class="tag tag-geo" *ngFor="let g of f.geographies">{{ g }}</span>
                </div>
              </td>

              <td><span class="pill">{{ f.currency }}</span></td>
              <td class="num">{{ f.fundSize }}</td>
              <td class="num">{{ f.vintage }}</td>

              <td>
                <div class="tags">
                  <span class="tag tag-manager" *ngFor="let m of f.managers">{{ m }}</span>
                </div>
              </td>

              <td class="actions">
                <a
                  class="icon-btn"
                  [routerLink]="['/admin/edit', f.id]"
                  title="Edit"
                  aria-label="Edit"
                >
                  ✏️
                </a>
              </td>
            </tr>

            <tr *ngIf="pageItems().length === 0">
              <td colspan="8" class="empty">No results. Try changing filters.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination Footer -->
      <div class="pager" *ngIf="!loading() && !error() && totalItems() > 0">
        <div class="pager-left">
          <button class="btn ghost" (click)="prevPage()" [disabled]="page() === 1">← Prev</button>
          <button class="btn ghost" (click)="nextPage()" [disabled]="page() === totalPages()">Next →</button>
          <span class="pager-info">
            Page <b>{{ page() }}</b> of <b>{{ totalPages() }}</b>
          </span>
        </div>

        <div class="pager-right">
          <button
            class="page-btn"
            [class.active]="page() === 1"
            (click)="setPage(1)"
            *ngIf="totalPages() > 1"
          >
            1
          </button>

          <span class="dots" *ngIf="pageRange()[0] > 2">…</span>

          <button
            class="page-btn"
            *ngFor="let p of pageRange()"
            [class.active]="page() === p"
            (click)="setPage(p)"
          >
            {{ p }}
          </button>

          <span class="dots" *ngIf="pageRange()[pageRange().length - 1] < totalPages() - 1">…</span>

          <button
            class="page-btn"
            [class.active]="page() === totalPages()"
            (click)="setPage(totalPages())"
            *ngIf="totalPages() > 1"
          >
            {{ totalPages() }}
          </button>
        </div>
      </div>
    </section>
  </div>
</div>